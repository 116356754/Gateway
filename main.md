---
typora-copy-images-to: assets
typora-root-url: assets
---

# 前言

LMGateway配置工具可稳定运行在Windows XP/ Windows  7/Windows 10系统下。管理一个或多个工程，每个工程下可挂载多个网关。

注意：window10由于安全策略的问题，不能把软件安装在C盘（系统盘）下。

通过双击安装图标，按照指定提示操作，可完成软件安装，安装后桌面出现Gateway配置工具图标，双击图标可进入工程配置页面。

配置工具分为三部分：

- 模板:根据被采集设备的不同协议,地址可以新建不同的设备模板,方便工程配置中装载,引用；   
- 工程:工程配置用于配置网关的数据采集,数据运算,数据存储,事件管理,数据服务等功能模块,是配置软件的核心组成部分。可以选择新建工程文件，或者打开软件目录下的工程文件，或者上载网关内的工程文件；   
- 设备:配置工具管理在线网关的功能，获取在线网关列表，网关的实时数据、存储数据等，还可以对网关进行校时、重启操作等。

如您在使用过程中出现问题，请及时与我们联系：

手机： 18049040679  

微信： 18049040679

QQ ： 1926608609

邮箱： [1926608609@qq.com](mailto:1926608609@qq.com)　

网址：  <http://www.lmgateway.com>







<div STYLE="page-break-after: always;"></div>

# 1 配置工程

##     1.1 新建工程

打开运行主程序Gateway.exe后，点击工具栏中的“新建工程”按钮，在弹出的“新建工程”对话框中输入工程名称，最后单击“确定”，操作步骤如图1-1所示。

![1-1 新建工程.png](/1-1 新建工程.png)

<center>图1-1 新建工程</center>



##     1.2 添加网关设备

工程新建完成以后，在“工程”选项卡中就会出现以工程名称为文本的根节点，之后就可进行具体的网关配置。

单击选中工程名称节点，右键单击选择“添加网关设备”，自定义网关名称和备注，选择网关分类和网关型号，具体操作如图1-2所示。

<font color=red size=4>注意：下载工程到网关时会进行网关型号的验证。</font>

<font color=blue size=4>提示：网关的侧标签有网关型号、网关版本和默认IP等信息。</font>

![1-2 添加网关设备](/1-2 添加网关设备.png)

<center>图1-2 添加网关设备</center>

网关设备添加完成以后，在“工程”选项卡里就会根据网关型号的不同显示相应的工程树，如图1-3所示。

![1-3 新建网关设备完成](/1-3 新建网关设备完成.png)

<center>图1-3 新建网关设备完成</center>



##     1.3 通道配置及协议选择

LMGateway网关支持串口、网口采集，可新增或修改通道参数。



###      1.3.1 新建通道

单击选中“I/O点”节点，右键单击选择“新建通道”，配置工具会根据“添加网关设备”时选择的网关型号显示可以添加的协议，在此我们选择“ModbusTCPClient”协议作为范例进行演示，如图1-4所示。

![1-4 新建通道](/1-4 新建通道.png)

<center>图1-4 新建通道</center>

在通道参数设备的弹出框中，进行从上往下的顺序配置，先设置在此网关设备中唯一的通道名称，之后根据上图的步骤进行配置：

1. 根据需要配置的采集协议选择通道是串口还是网关；
2. 进一步选择具体的协议；
3. 配置协议的基本参数；
4. 配置协议的高级参数；

在每个协议的基本参数中都会包含超时时间、间隔时间、轮询时间和重试次数四项，含义如下：

- 超时时间：网关等待设备响应的最长时间。当通信正常的情况下，设置 长一点不影响通信速度；假如设备响应速度比较慢，为了避免通信失败，建议可以设置长一点。
- 间隔时间：网关接收到被采集设备返回的报文后等待间隔时间之后再发送下一组报文。
- 轮询时间：当前通道中完成所有采集任务后，等待轮询时间，再进入下一次采集周期。
- 重试次数：通讯失败后重新发送当前报文的次数。

通道配置界面根据协议的不同会判断是否显示高级参数的按键。如果基本参数不满足当前的应用场景，就需要设置高级参数，每种协议的高级参数也有所不同，如上图Modbus协议中高级参数为watch time、采集使用连续地址和读写占空比，含义如下：

- watch time: 设备故障时间，在当前通道下的设备通讯不上时，在watch time间隔内，不会再采集这个设备。

- 采集使用连续地址：默认勾选，网关会根据配置的Modbus地址的连续性自行组成报文统一采集。

- 读写占空比：用于控制写操作与读操作的比率。占空比的默认设置为 1：1，这意味着每次读取操作对应一次写入操作。即使在应用程序执行大量的连续写入操作时，也必须确保足够的读取数据处理时间。如果将占空比设置为 1：10，则每次读取操作对应十次写入操作。如果未执行任何写入操作，则会连续处理读取操作。

  

###       1.3.2 修改通道

选择需要修改的通道，双击即可弹出修改通道的窗口。如图1-5所示。

![1-5 修改通道](/1-5 修改通道.png)

<center>图1-5 修改通道</center>



##      1.4 设备及点表编辑

###       1.4.1 新建设备

单击选中需要添加设备的通道，右键选择“新建设备”，如图1-6所示。

![1-6 新建设备](/1-6 新建设备.png)

<center>图1-6 新建设备</center>

编辑设备属性，点击确定生效。

- 设备名称：自定义，设备在该通道下的唯一标记，不可重复； 
- 设备地址：设备的通讯地址，如Modbus RTU从站设备的站号（slave ID）, 645电能表的表号，BACnet的设备ID等；



###       1.4.2 复制新增设备

同一个通道下的设备具有相同的协议属性，我们可以选中已编辑好的设备，右键“复制设备”，编辑新设备的设备名称，设备地址即可。这个操作可以快速编辑完成一个通道下的若干设备。如图1-7所示。

![1-7 复制新增](/1-7 复制新增.png)

<center>图1-7 复制新增设备</center>



###       1.4.3 编辑点表

单击左侧工程树中的设备，进入设备采集点表编辑页面，我们根据协议种类不同分别编辑了一下页面

[Modbus采集点表](Protocol/Modbus.md)

[DLT采集点表](Protocol/DLT.md)

[CJ188采集点表](Protocol/CJ188.md)

[BACnet采集点表](Protocol/BACnet.md)



##      1.5 用户点

前面部分讲到实际数据采集I/O点的配置，但工程部署中还需要一些非实际I/O的点，这些点是用户可选可配，即用户点，这些用户点可用于JavaScript编程，可作为一个控制信号，也可作为一个运算结果的呈现。

1. 单击工程树上的“用户点”节点。
2. 点击“添加”按钮新增一个用户点。
3. 输入用户点配置页面中唯一的名称，选择点类型，添加该点的默认值。
4. 点击“保存”完成添加点。

具体步骤如图1-8所示。

![1-8 用户点](/1-8 用户点.png)

<center>图1-8 添加用户点</center>



##      1.6 计算点

计算点是一种特殊的Tag点，它的值是某个表达式的计算结果，该表达式的参数可以是Tag点或常数，在表达式中可以使用一些常用的计算方法，包括四则运算，逻辑运算，三角函数等。

通过使用计算点，可以做一些相对复杂的计算，例如将采集到的传感器数值通过换算得到实际的物理量（如液位、风速等），这样可以减少上位机的运算量，也使得设备更加智能化。

每个计算点对应一个表达式，表达式可以有最多4个Tag点作为输入变量，为了方便起见，4个Tag点在表达式中分别使用A，B，C，D来表示。操作步骤如下：

1. 单击工程树上的“计算点”节点。

2. 点击“添加”按钮新增一个计算点。
3. 输入计算点配置页面中唯一的名称。
4. 输入计算表达式，表达式中可使用的预设函数或运算符可以从表达式输入框上方的几个下拉框中选择，也可以手动输入预设的函数或运算符。 

5. 单击表达式变量的输入框左侧添加按钮，选择该变量对应的Tag点。

6. 点击“确定”完成添加点。

具体步骤如图1-9所示。

![1-9 计算点](/1-9 计算点.png)

<center>图1-9 计算点配置</center>



##      1.7 系统点

系统点保存网关的时间信息和通道下设备与网关的通讯状态，在I/O点中新建设备后，系统点页面会自动添加该设备的系统点，服务协议也可以把系统点映射到自身服务当中。页面如图1-10所示。

![1-10 系统点](/1-10 系统点.png)

<center>图1-10 系统点</center>



##      1.8 数据存储

LMGateway网关具备数据存储功能，这种功能可以实现I/O点、用户点、计算点和系统点的数据存储，目前网关的数据只能存储到TF卡当中。（TF卡不支持ntfs格式）

### 1.8.1 数据存储配置

开启数据存储功能，需要在数据存储页面进行相关的配置，如图1-11所示。

![1-11 数据存储](/1-11 数据存储配置.png)

<center>图1-11 数据存储配置</center>

1. 单击“数据存储”节点，打开数据存储的配置页面；

2. 勾选“启用”复选框；

3. 选择存储模式：周期存储（需要设置存储周期）和准点存储（需要添加每天存储的整点时间）；

4. 点击“保存”完成配置。

   

### 1.8.2 添加存储点

在数据存储功能中，用户可以自行添加需要存储的点，具体步骤如下：

1. 单击“添加”按钮；
2. 在弹出的选择点窗口中勾选需要存储的点；
3. 点击”确定“按钮完成存储点的添加。

如图1-12所示。

![1-12 添加存储点](/1-12 添加存储点.png)

<center>图1-12 添加存储点</center>



## 1.9 数据服务

LMGateway网关具有三种标准协议服务：Modbus协议，BACnet协议，OPC UA协议。这三种协议可实现网关与下方采集设备及上方中心设备的通讯。

### 1.9.1 Modbus Service

Modbus服务器实现了Tag点到Modbus地址的映射，允许上位机Modbus Client通过Modbus TCP或者Modbus RTU的协议读写Tag点。

Modbus TCP和Modbus RTU通用参数如下：

1. slaveID：网关Modbus服务的设备ID；
2. 网关通讯异常处理：在映射的Tag点出错时，相应的Modbus地址的点值会发生相应的改变，目前“网关通讯异常处理”下拉框中有“使用默认值”（相应的Modbus地址的点值设置成表格中“默认值”列的值）、“使用最后正常值”（相应的Modbus地址的点值不发生改变）

**Modbus TCP配置**

通过使能Modbus TCP服务，即可允许上位机通过ModbusTCP协议经由网口连接来访问设备。

端口号：设置Modbus TCP侦听端口号，默认值是502。

**Modbus RTU配置**

通过使能Modbus RTU服务，在点击“配置”按钮弹出的对话框中指定Modbus RTU服务的串口和相应的串口配置，即可允许上位机通过Modbus RTU协议经由串口连接（RS-232/485)或者虚拟串口连接来访问设备。

**Modbus DTU配置**

通过使能Modbus DTU服务，即可允许网关先通过填写的服务器地址和端口连接服务器，然后向服务器提供modbus服务功能，服务器能读写网关内的Tag点。

**Modbus地址映射**

为了Modbus客户端可以访问到设备上的Tag点，需要将Tag点映射到对应的Modbus地址上，配置步骤如下：

1. 单击“添加”按钮；
2. 在弹出的选择点窗口中勾选需要映射的点；
3. 选择窗口中所有的点映射的数据区、数据类型和字节序；
4. 点击”确定“按钮完成映射点的添加。

重复上述操作可添加更多的点到地址列表。

如图1-13所示。

![1-13 Modbus地址映射](/1-13 Modbus地址映射.png)

<center>图1-13 Modbus地址映射</center>

修改Tag点映射到Modbus地址的详细设定，可配置项有：

- 数据区：有0X (Coil Status),1X (Input Status),3X (Input Registers),4X (Holding Register)四种类型，分别对应Modbus的0,1,3,4四个区；
- Modbus寄存器地址：指定该Tag点在Modbus地址空间的起始地址，最小的地址为1。Modbus寄存器地址和数据区配合使用，如数据区选择4X (Holding Register)，Modbus寄存器地址填写1，这该点的Modbus地址为400001。
- Modbus数据类型：有bool、bit、uint16、int16、uint32、int32、float、double、uint64、int64共10种。
- 字节序：有Null、Big-endian、Little-endian、Big-endian byte swap、Little-endian byte swap共5种，其中Null用于比特数为16及16以下的数据类型当中；
- 默认值：默认设为9999，可修改，在“网关通讯异常处理”中选择了“使用默认值”时起作用：在映射的Tag点出错时，相应的Modbus地址的点值设置成该默认值。



### 1.9.2 BACnet Service

用户通过勾选"启用BACnetIP服务"和"启用BACnetMSTP服务"选择需要启用的BACnet  Service服务。

- BACnetIP服务默认端口为47808，通过绑定的网口进行数据交互。  
- BACnetMSTP服务通过绑定的串口进行数据的交互。 

**BACnet地址映射**

为了BACnet客户端可以访问到设备上的Tag点，需要将Tag点映射到对应的BACnet地址上，配置步骤如下：

1. 选择需要映射的BaCnet上传表中的数据类型，目前的数据类型有AI,AO,AV,BI,BO,BV,MSI,MSO,MSV；
2. 单击“添加”按钮；
3. 在弹出的选择点窗口中勾选需要映射的点；
4. 点击”确定“按钮完成映射点的添加。

重复上述操作可添加更多的点到地址列表。

如图1-14所示。

![1-14 BACnet地址映射](/1-14 BACnet地址映射.png)

<center>图1-14 BACnet地址映射</center>

修改Tag点映射到BACnet地址的详细设定，可配置项有：

- 对象名称：可编辑，BACnet数据点的对象名称。
- 对象描述：可编辑，BACnet数据点的对象描述。
- 对象索引号：必填项，与AI,AO,AV,BI,BO,BV组合为AI0，AI1，AI2等。
- 单位：可编辑，通过下拉框选择。

MSI、MSO、MSV为多态，如果需要映射到BACnet的多态上，MSI、MSO、MSV的页面中“多态”列必须要有最少一个状态。



### 1.9.3 OPC UA

用户通过勾选"启用"和修改端口号来启动OPC UA服务。

**OPC UA地址映射**

为了OPC UA客户端可以访问到设备上的Tag点，需要将Tag点映射到对应的OPC UA地址上，配置步骤如下：

1. 单击“添加”按钮；
2. 在弹出的选择点窗口中勾选需要映射的点；
3. 点击”确定“按钮完成映射点的添加。

重复上述操作可添加更多的点到地址列表。

如图1-15所示。

![1-15 OPC UA地址映射](/1-15 OPC UA地址映射.png)

<center>图1-15 OPC UA地址映射</center>



## 1.10 IoT

### 1.10.1 Mqtt Client

LMGateway可以通过MQTT协议与云上的IoT中心设备终结点通信。目前LMGateway支持与阿里云、百度云等云服务商的IoT中心通信。

用户可以在Mqtt Client页面配置设备，让设备将tag点信息上传到IoT中心，同时支持不同主题、不同频率的上传。

用户需要配置IoT中心连接属性、发布订阅的主题、需要上传的tag点等属性。

#### **1.10.1.1 基础连接属性**

- 启用云服务，启用后网关设备才会进行MQTT的连接；
- IP地址/域名、端口：网关设备需要连接的服务器的IP和端口号；
- ClientID：客户端唯一标识，同一时间内 Server 和同一个 ClientID 只能保持一个 TCP 连接，再次连接会踢掉前一个。

![1-18 mqtt基础连接属性](/1-16 mqtt基础连接属性.png)

<center>图1-16 mqtt基础连接属性</center>

#### 1.10.1.2 进阶连接属性

1. Gerenal

   - Keep Alive(s)：心跳，客户端在Connect的时候设置 Keep Alive 时长。如果服务端在 1.5 * KeepAlive 时间内没有收到客户端的报文，它必须断开客户端的网络连接，默认为60秒。

   - Timeout(s)：定义客户端发送信息到云端响应的最大时间间隔，客户端超过时间没有得到相应后会主动中断连接，默认为30秒。

   - Clean Session：

     NO——开启会话重用机制。网络断开重连后，恢复之前的Session信息。需要客户端和服务器有相关Session持久化机制。

     YES——关闭会话重用机制。每次Connect都是一个新Session，会话仅持续和网络连接同样长的时间。

   ![1-17 mqtt Gerenal](/1-17 mqtt Gerenal.png)

   <center>图1-17 mqtt Gerenal</center>

2. User Credentials

   用户名和密码：根据服务器的配置来确定在mqtt连接时是否需要经过用户名和密码的验证。

   ![1-18 mqtt User Credentials](/1-18 mqtt User Credentials.png)

   <center>图1-18 mqtt User Credentials</center>

3. SSL/TLS

   默认为不启用SSL安全连接，用户需要启用SSL时可以选择两种方式：

   - 单向验证——需要上传CA文件到设备，当设备与云连接时，设备作为客户端提供证书供云服务商验证是否安全。CA文件由云服务商提供。
   - 双向验证——需要上传CA文件、Cert文件、KEY文件到设备，当设备与云连接时，客户端与云端均向对方提供证书，相互验证。

   ![1-19 mqtt SSLTLS](/1-19 mqtt SSLTLS.png)

   <center>图1-19 mqtt SSL/TLS</center>

4. Last Will and Testament

   ​    默认不启用遗嘱，遗嘱是当网络连接关闭时，服务端必须发布这个遗嘱消息，所以被形象地称之为遗嘱，可用于通知异常断线。启用遗嘱时需要设置遗嘱主题和遗嘱内容。

   ![1-20 mqtt Last Will and Testament](/1-20 mqtt Last Will and Testament.png)

<center>图1-20 mqtt Last Will and Testament</center>

#### 1.10.1.3 发布、订阅主题配置

**实时数据发布主题：多主题、多频率、多格式上传**

可通过增删改按钮对实时数据的主题进行操作，每个主题可以使用不同的主题配置、不同的上传频率、不同的数据过滤方式、不同的上传数据的模板等。添加的主题就会显示到实时主题下拉列表框中，选择下拉列表中一个主题然后通过右侧的“添加”按钮添加需要通过该主题上传的数据。

![1-21 mqtt realtopic](/1-21 mqtt realtopic.png)

<center>图1-21 mqtt 实时数据发布主题</center>

**拓展主题**

- 离线数据发布的主题：网关在mqtt断线时，会根据上传的频率把数据存储在网关当中，在mqtt重连成功时会向离线数据的主题依次发送存储的数据。目前网关设备存储离线数据的容量为20M，当离线数据大于20M时，网关就会在存储新的离线数据时删除最早的离线数据。

- 查询数据的主题：在mqtt配置界面中“查询数据订阅的主题”一项输入需要订阅的主题，通过在mqtt服务器该主题上发布如下所示的格式的数据，即可实现查询数据的操作，网关会通过配置界面中“查询数据发布的主题”发布此次查询到的数据。

  {"operate":"read","devices":[{"deviceCode":"Device_1","tags":null},

  {"deviceCode":"Device_2","tags":[{"tagCode":"tag0008"}]}]}

- 推送事件的主题：如果在“报警与事件”(1.12章节)当中配置了报警事件，当报警事件触发或者解除时网关设备会保存该事件并且会通过推送事件的主题将该事件发布到云服务器。

- 控制操作的主题：在mqtt配置界面中“写操作订阅的主题”一项输入需要订阅的主题，通过在mqtt服务器该主题上发布如下所示格式的数据，即可实现写入数据的操作。

  [{"operate":"write","deviceCode":"Device_1","tagCode":"tag0001", "val":"10"}]

  deviceCode：采集协议页面中的设备名称,

  tagCode：数据点的名称；

  val：需要写入的数值。

- 重启网关的主题：在mqtt配置界面中“重启网关订阅的主题”一项输入需要订阅的主题，通过在mqtt服务器该主题上发布如下所示的格式的数据，即可实现重启网关的操作。

  {"operate":"reboot"}

- 配置网关的主题：通过云服务器将配置工具配置生成的数据库配置文件转换成二进制发布到配置网关的主题当中，实现远程配置网关。

  ![1-22 mqtt 拓展主题](/1-22 mqtt 拓展主题.png)

  <center>图1-22 mqtt 拓展主题</center>

**高级参数**

 如果需要在mqtt上传的JSON格式当中添加一些自定义的字段，可以通过“高级参数”的字段和修改模板的方式达到要求。 

在Mqtt Client页面点击“添加”按钮添加了需要上传的Tag点之后，可以双击需要添加自定义字段的Tag点，在“高级参数”字段中添加所需要的json键值对，如

{"unit":"摄氏度"}，然后通过联系配置工具制作商修改模板，就可以把“unit”当成此Tag点的属性生成json然后通过实时数据的主题上传。

![1-23 mqtt 高级参数](/1-23 mqtt 高级参数.png)

<center>图1-23 mqtt 高级参数</center>



### 1.10.2 IoTDDC

应用于本公司的能耗建筑管理系统当中。

1. 通过填写分配的IP、ClientID，自定义上传周期，点击“保存”按钮即可完成IoTDCC的连接配置；
2. 点击“添加”按钮，完成需要上传的数据点的添加；
3. 点击“上传云端”按钮，将当前的工程上传到云服务器当中。

![1-24 IoTDCC](/1-24 IoTDCC.png)

<center>图1-24 IoTDCC</center>



## 1.11 任务计划

LMGateway网关支持任务计划功能，用户通过建立任务计划，可以实现任意时刻设置多个点值的操作。具体操作如下：

1. 单击“添加”按钮；
2. 在弹出的编辑框中添加不重复的任务计划的名称、起始时间、结束时间和必须选中一星期中的某一天或几天；
3. 点击”+“按钮使之弹出新的Tag点添加文本框和写入值的文本框；
4. 点击“Add”按钮，在弹出的“选择点”窗口中选择一个需要写入值的点；
5. 在写入值的文本框中填入需要写入的值；
6. 可重复3,4,5的步骤进行多点的写入；
7. 点击”确定“按钮完成任务计划的添加。

如图1-25所示。

![1-25 任务计划](/1-25 任务计划.png)

<center>图1-25 任务计划配置</center>

如果想修改已经添加的任务计划，只需要双击需要修改的任务计划，就会弹出上图的任务计划的窗口。重复上述步骤完成任务计划的修改。



## 1.12 报警与事件

 报警与事件页面允许用户设置事件的触发条件，当满足条件时触发事件，当状态从满足条件转变为不满足条件时执行事件解除。

可以添加、删除、修改、复制一个事件。 

- 添加：弹出事件编辑页面，新建一个事件  。
- 删除：删除选中的事件  。
- 修改：双击需要修改的时间，弹出事件编辑页面，修改选中的事件 。

事件编辑页面如图1-26所示。

![1-26 报警与事件](/1-26 报警与事件.png)

<center>图1-26 事件编辑</center>

1. 单击“添加”按钮；
2. 编辑唯一的事件名称；
3. 通过选择“事件种类”进一步填写事件参数
   - 间隔时间：每隔间隔时间判断一次关联点是否满足事件触发或解除的条件。
   - 关联点名称：可以为I/O点、用户点、计算点和系统点中的其中一个点。
   - 最大值、最小值：关联点的值的范围。
   - 抖动时间：当点值超过范围或质量不为good持续的时间小于抖动延时，此时不触发事件。
4. 在“当事件触发”的窗体中添加事件触发时写入的点和值；
5. 在“当事件解除”的窗体中添加事件解除时写入的点和值；
6. 点击”确定“按钮完成事件的添加。



## 1.13 JavaScript脚本编辑

LMGateway网关还带有 JS 脚本编辑器， 脚本编辑器内置一些函数，用户可以通过编辑脚本语言实现一些逻辑控制。具体操作如下：

1. 单击“添加”按钮；
2. 在弹出的编辑框中添加不重复的js名称、选择执行方式和填写相应的参数；
3. 单击选中需要运行的函数；
4. 点击“Add”按钮，在弹出的“选择点”窗口中选择一个需要读取或者设置的点；
5. 单击“插入”按钮，将新建的函数添加到js编辑框的光标后面；
6. 可重复3,4,5的步骤进行多个函数的添加；
7. 点击”确定“按钮完成js脚本的编辑。

![1-27 js脚本编辑](/1-27 js脚本编辑.png)

<center>图1-27 js脚本编辑</center>

上图中的js脚本为：

oldVal = ReadFloat('user.tag0001');
        currentVal = ReadFloat('Device1.tag0001');
        newVal = currentVal  - oldVal ;
        WriteFloat('user.tag0002',newVal );
        WriteFloat('user.tag0001',currentVal);

上图的描述为在每天早上8点时，将当前的Device1.tag0001的实时数据减去昨天早上8点时Device1,tag0001的实时数据，将结果存入用户点user.tag0002中（user.tag0001用来保存昨天早上8点Device1,tag0001的数据）

<div STYLE="page-break-after: always;"></div>

# 2 运行工程

## 2.1 软件网关运行

工程配置完成之后，点击工具栏当中的“运行工程”按钮，此时就会在电脑上根据当前工程进行数据采集和数据服务。在系统日志栏中会打印程序运行时输出的日志和报文，便于调试。

在软件网关运行时，可以通过点击通道下的设备进行查询设备下所有点的实时数据。

![2-1 软件网关运行时](/2-1 软件网关运行时.png)

<center>图2-1 软件网关运行时</center>



## 2.2 查询报警记录

点击工具栏中“数据库”下拉列表中的查询报警记录，在弹出的子页面当中选择需要查询的报警记录的起始时间和结束时间，点击查询按钮，查询结果如图2-2所示。

![2-2 查询报警记录](/2-2 查询报警记录.png)

<center>图2-2 查询报警记录</center>



<div STYLE="page-break-after: always;"></div>

# 3 网关在线功能

需要网关与电脑在同一网段才能进行通讯。

## 3.1 添加、搜索、查看网关

**添加网关**

如果你知道网络中LMGateway的IP地址，那么你可以通过添加设备的方式将此设置添加到在线设备列表中。

![3-1 添加网关](/3-1 添加网关.png)

<center>图3-1 添加网关</center>

**搜索网关**

将网络中的LMGateway全部搜索并列到Online gateway列表中。

![3-2 搜索网关](/3-2 搜索网关.png)

<center>图3-2 搜索网关</center>

**查看网关信息**

双击需要查看信息的网关IP，在弹出的窗口中包含网关的硬件版本、软件版本、支持点数和SN号，其中支持点数是指网关中的数据点低于支持点数时可以保证网关的运行效率。

![3-3 网关信息](/3-3 网关信息.png)

<center>图3-3 网关信息</center>



## 3.2 查看实时数据

Gateway Configuration具有监控LMGateway数据的功能，单击需要监控的网关的IP，就会在右侧显示通过HTTP接口查询到的所有实时数据，可以通过点击左侧的通道设备树节点来查看单一的通道或者设备的数据。

![3-3 实时数据](/3-3 实时数据.png)

<center>图3-3 实时数据</center>



## 3.3 设置Tag点

Gateway Configuration可以通过HTTP协议对网关下面的采集设备进行写操作。

在实时数据页面，单击需要写入的Tag点的value，在弹出的窗口中输入需要写入的value，之后点击“写入”按钮。

![3-4 设置Tag点](/3-4 设置Tag点.png)

<center>图3-4 设置Tag点</center>



## 3.4 系统设置

### 3.4.1 设置IP

用户可以通过Gateway Configuration修改在线LMGateway网口的IP地址和DNS，也可以设置网口为DHCP。

点击“应用到网关”按钮之后，网关会马上应用当前配置的IP。

![3-5 设置IP](/3-5 设置IP.png)

<center>图3-5 设置IP</center>



### 3.4.2 上载工程

Gateway Configuration可以将当前网关的配置文件上载到本地。

点击“上载工程”时，为防止工程被他人上载，如果当前网关使用了密码，在上载工程时会需要用户输入密码之后才能进行上载工程的操作。

![3-6 上载工程](/3-6 上载工程.png)

<center>图3-6 上载工程</center>



### 3.4.3 密码设定

LMGateway网关出厂默认没有设置密码，用户出于安全的考虑可以给网关设置密码，密码需要用户自己记录。

![3-7 密码设定](/3-7 密码设定.png)

<center>图3-7 密码设定</center>



### 3.4.4 网关校时

- 使网关根据设定的周期与NTP服务器同步时间
- 将网关时间同步成电脑时间
- 将网关设置为一个时间同步源，其他设备可以与这台网关同步时间

![3-8 网关校时](/3-8 网关校时.png)

<center>图3-8 网关校时</center>

如果只需要将网关时间与电脑时间同步，只需要点击“与电脑时间同步”按钮；

如果需要设置上图中的1、2，设置好之后需要点击“设置网关”按钮。



### 3.4.5 重启网关

Gateway Configuration可以通过HTTP接口对网关进行重启。

![3-9 重启网关](/3-9 重启网关.png)

<center>图3-9 重启网关</center>



### 3.4.6 网关升级

建议用户不要随意点击，需要进行网关升级时请先联系厂家。

在升级过程中请不要操作Gateway Configuration和网关，在升级结束时会在系统日志中输出相应的信息。

![3-10 网关升级](/3-10 网关升级.png)

<center>图3-10 网关升级</center>



## 3.5 历史上传

在1.8 数据存储章节当中，网关的数据存储功能会把数据存储在TF卡当中，用户可以通过点击工具栏中“数据库”下拉列表当中的“历史上传”将TF卡中的数据库上传到本地。

![3-11 历史上传](/3-11 历史上传.png)

<center>图3-11 历史上传</center>



## 3.6 查询报警记录

点击工具栏中“数据库”下拉列表中的查询报警记录，在弹出的子页面当中选择需要查询的报警记录的起始时间和结束时间，点击查询按钮，可以查询网关在时间段内所有的报警记录，查询结果如图3-12所示。

![3-12 查询网关报警记录](/3-12 查询网关报警记录.png)

<center>图3-12 查询网关报警记录</center>



## 3.7 调试模式

用户通过点击工具栏中的“调试模式”按钮进入调试模式。

Gateway Configuration的调试模式分为三部分：网关数据采集日志和报文输出、网关Ping测试、网关串口测试。



### 3.7.1 网关数据采集日志和报文输出

用户可以通过调试模式查看网关在运行过程中交互的报文，便于遇到通讯出错时找出问题。

![3-13 网关数据采集日志和报文输出](/3-13 网关数据采集日志和报文输出.png)

<center>图3-13 网关数据采集日志和报文输出</center>



### 3.7.2 Ping测试

用户通过输入需要网关ping的IP，点击“确定”按钮即可使网关进行ping操作。(默认进行5次ping操作，5次之后停止)，在点击“确定”之后网关就会结束采集进程，需要点击“调试”选项卡或者重启网关使网关根据工程文件进行采集和服务。

![3-14 ping测试](/3-14 ping测试.png)

<center>图3-14 ping测试</center>



### 3.7.3 串口测试

用户可以通过串口测试发送指定的报文，查看是否有返回的报文或返回的报文是否出错，验证串口配置和接线是否正常。

![3-15 串口测试](/3-15 串口测试.png)

<center>图3-15 串口测试</center>

<div STYLE="page-break-after: always;"></div>

# 4 模板

Gateway Configuration具有保存模板和装载模板的功能，目的是便于用户在配置相似或相同的采集设备时减少操作。

## 4.1 新建模板

点击工具栏中的“新建模板”按钮，在弹出框中填写不重复的模板名称，选择模板的驱动协议。

![4-1 新建模板](/4-1 新建模板.png)

<center>图4-1 新建模板</center>

单击左侧模板树中刚才新建的模板，通过“添加”按钮一个一个Tag点的添加或者通过在Excel中编写完成之后“导入Excel”，就完成了一个模板的新建，在工程页面可以通过“装载模板文件”的按钮装载各个模板，简化配置工程的步骤。

![4-2 编辑模板](/4-2 编辑模板.png)

<center>图4-2 编辑模板</center>



## 4.2 修改模板名称

双击需要修改名称的模板，在弹出框中修改模板名称，点击“确定”按钮。

![4-3 修改模板名称](/4-3 修改模板名称.png)

<center>图4-3 修改模板名称</center>



## 4.3 删除模板

单击选中需要删除的模板，右键选择“删除模板”。

![4-4 删除模板](/4-4 删除模板.png)